# Este fluxo de trabalho farÃ¡ uma instalaÃ§Ã£o limpa de dependÃªncias do node,
# cache/restaurÃ¡-las, construir o cÃ³digo-fonte e implantÃ¡-lo no GitHub Pages.

name: Deploy React App to GitHub Pages ğŸš€

on:
  # O deploy deve ser executado no push para o branch principal
  push:
    branches: [ "main" ]
  # Adicionado para permitir o deploy manual a partir da aba Actions
  workflow_dispatch:

# Define as permissÃµes necessÃ¡rias para o deploy
permissions:
  contents: read
  pages: write # PermissÃ£o necessÃ¡ria para publicar no GitHub Pages
  id-token: write # NecessÃ¡rio para autenticar no OIDC

jobs:
  # O trabalho de build continua quase o mesmo
  build:

    runs-on: ubuntu-latest

    # REMOVIDO: A matriz de versÃ£o do Node nÃ£o Ã© estritamente necessÃ¡ria para o deploy
    # Usaremos uma versÃ£o estÃ¡vel
    strategy:
      matrix:
        node-version: [20.x] 

    steps:
    - uses: actions/checkout@v4
    
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'
        
    - name: Instalar DependÃªncias ğŸ“¦
      run: npm ci
      
    - name: Construir a AplicaÃ§Ã£o (Build) ğŸ—ï¸
      # Ã‰ crucial que este comando gere os arquivos estÃ¡ticos na pasta 'build' ou 'dist'
      run: npm run build
      
    - name: Configurar PÃ¡ginas GitHub (Setup Pages)
      uses: actions/configure-pages@v4
      
    - name: Upload de Artefato de Build â¬†ï¸
      # Esta etapa 'empacota' os arquivos gerados pela build para o deploy
      uses: actions/upload-pages-artifact@v3
      with:
        # Altere para o diretÃ³rio de saÃ­da correto se nÃ£o for 'build' (ex: 'dist')
        path: './build' 
        
  # Novo trabalho para o deploy
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    # O deploy sÃ³ deve ser executado apÃ³s o build ter sido concluÃ­do com sucesso
    needs: build 
    
    steps:
      - name: Deploy para GitHub Pages ğŸ“¤
        id: deployment
        uses: actions/deploy-pages@v4
